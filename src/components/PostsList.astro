---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

export interface Props {
  category?: string;
}

const { category } = Astro.props;

const posts = (await getCollection("posts"))
  .filter(p =>
    category
      ? p.data.tags?.map(t => t.toLowerCase()).includes(category.toLowerCase())
      : true,
  )
  .sort((a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf());
---

<ul class="grid grid-cols-1 md:grid-cols-2 gap-4">
  {
    posts.map(post => (
      <li class="text-center mb-4">
        <a href={`/posts/${post.slug}`}>
          <Image
            class="border border-slate-300 dark:border-zinc-700 rounded-xl"
            src={post.data.heroImage || "/cover.jpeg"}
            width={720 * 2}
            height={500 * 2}
            alt="Thumbnail"
          />
          <div class="mt-3 text-xl">{post.data.title}</div>
          <div class="opacity-70">{post.data.description}</div>
        </a>
      </li>
    ))
  }
</ul>
